@using MixERP.Purchases.Extensions
@model dynamic

@{
    ViewBag.Title = "Purchase Quotation";
    Layout = ViewBag.PurchaseLayoutPath;
}


@Html.FinancePartialView("Shared/JournalView.cshtml", TenantConvention.GetTenant())

<script>
    window.prepareView({
        Title: "Purchase Quotation",
        AddNewText: "Add New",
        AddNewUrl: "/dashboard/purchase/tasks/quotation/new",
        ReturnText: "Return",
        ReturnUrl: "javascript:void(0);",
        Book: "Purchase Quotation",
        ChecklistUrl: "/dashboard/purchase/tasks/quotation/checklist/{tranId}",
        AdviceButtons: [
            {
                Title: "View Purchase Quotation",
                Href: "javascript:void(0);",
                OnClick: "showInvoice({tranId});"
            }
        ]
    });

    $("#ReturnButton").click(function () {
        function getSelectedItem() {
            const selected = $("#JournalView").find("input:checked").first();

            if (selected.length) {
                const row = selected.parent().parent().parent();
                const id = row.find("td:nth-child(3)").html();
                return parseInt(id);
            };

            return 0;
        };

        const selected = getSelectedItem();
        if (selected) {
            const url = "/dashboard/purchase/tasks/return/new?TransactionMasterId=" + selected;
            document.location = url;
            return;
        };

        window.displayMessage("Please select an item from the grid.");
    });

    function showQuotation(tranId) {
        $(".advice.modal iframe").attr("src", "/dashboard/reports/source/Areas/MixERP.Purchases/Reports/Order.xml?transaction_master_id=" + tranId);

        setTimeout(function () {
            $(".advice.modal")
                .modal('setting', 'transition', 'horizontal flip')
                .modal("show");

        }, 300);
    };
</script>